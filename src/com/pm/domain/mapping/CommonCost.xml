<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">  


	<mapper namespace="CommonCostMapping">


	<resultMap type="java.util.Map" id="map" />
	<resultMap type="com.pm.domain.business.CommonCost" id="commoncostMap" />


	<select id="getCommonCost" parameterType="com.pm.domain.business.CommonCost" resultMap="commoncostMap">
		select cc.* ,project.project_name,project.project_no
		from tb_common_cost cc
		INNER JOIN vb_project project 
		on cc.project_id = project.project_id 
		where cc.id = #{id}
	</select>

	<insert id="addCommonCost" parameterType="com.pm.domain.business.CommonCost" >
		insert into  tb_common_cost(
			id,staff_id,pay_item_id,use_month,pay_date,
			amount,description,import_order,build_datetime,build_username,
			build_userid,verify_username,verify_userid,verify_datetime
		)values  (
			#{id},#{staff_id},#{pay_item_id},#{use_month},#{pay_date},
			#{amount},#{description},#{import_order},#{build_datetime},#{build_username},
			#{build_userid},#{verify_username},#{verify_userid},#{verify_datetime}
		)
	</insert>

	<update id="updateCommonCost" parameterType="com.pm.domain.business.CommonCost" >
		update  tb_common_cost set 
		staff_id=#{staff_id},
		pay_item_id=#{pay_item_id},
		use_month=#{use_month},
		pay_date=#{pay_date},
		amount=#{amount},
		description=#{description},
		import_order=#{import_order},
		build_datetime=#{build_datetime},
		build_username=#{build_username},
		build_userid=#{build_userid},
		verify_username=#{verify_username},
		verify_userid=#{verify_userid},
		verify_datetime=#{verify_datetime}
		where id=#{id} 
		and verify_userid is null 
	</update>

	<update id="verifyCommonCost" parameterType="com.pm.domain.business.CommonCost" >
		update  tb_common_cost set 
		verify_userid = #{verify_userid}, 
		verify_username =  #{verify_username}, 
		verify_datetime = #{verify_datetime} 
		where id=#{id}

		and verify_userid is null
	</update>

	<update id="unVerifyCommonCost" parameterType="com.pm.domain.business.CommonCost" >
		update  tb_common_cost set 
		verify_userid = null, 
		verify_username = null, 
		verify_datetime = null
		where id=#{id}
	</update>

	<delete id="deleteCommonCost" parameterType="com.pm.domain.business.CommonCost" >
		delete from  tb_common_cost
		where id=#{id}
		and verify_userid is null
	</delete>

	<select id="queryCommonCostTotalAmount" parameterType="map"  resultType="double" >
		SELECT sum(amount) FROM (
			<include refid="commoncostPagerSql"/>
		) c
	</select>

	<select id="queryCommonCostByPager_mysql" parameterType="map"  resultMap="commoncostMap" >
		<include refid="commoncostPagerSql"/> LIMIT #{page.startRow},#{page.pageSize}
	</select>

	<select id="queryCommonCostByCount_mysql" parameterType="map"  resultType="int" >
		SELECT COUNT(*) FROM (<include refid="commoncostPagerSql"/> )c
	</select>

	<sql id="commoncostPagerSql">
		select cc.* ,project.project_name,project.project_no 
		from tb_common_cost cc  
		INNER JOIN vb_project project  
		on cc.project_id = project.project_id 
		WHERE 1=1 
		<include refid="permission" />
	</sql>




	<sql id="permission">

	<if test="UserPermit != null and UserPermit.range != null and UserPermit.range != ''">

		<if test="UserPermit.range == 1">

		</if>

	</if>

	</sql>



</mapper>